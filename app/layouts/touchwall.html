<polymer-element name="workspace-layout-touchwall" extends="app-layout">
    <template>
        <app-globals id="globals"></app-globals>
        <style>
            #container {
                margin: 5px;
                height: 100%
            }

            .widget {
                position: relative;
                height: 100%;
                width: 100%;
            }

            .widgetDropzone {
                float: left;
                margin-right: 5px;
                margin-bottom: 5px;
                width: 350px;
                height: 200px;
                box-sizing: border-box;
            }

            .dragging {
                width: 250px;
                height: 200px;
            }

            #mainWorkspace {
                position: relative;
                height: 100%;
                width: 100%;
                overflow: auto;
            }

            #mainWorkspace-dropzone {
                float: left;
                width: 100%;
                height: 100%;
            }



            .hidden {
                display: none;
            }

        </style>
        <div id="container">
            <div id="header"></div>
            <div class="widgetDropzone hidden" id="widget1-dropzone">
                <div class="widget" id="widget1"></div>
            </div>
            <div class="widgetDropzone hidden" id="widget2-dropzone">
                <div class="widget" id="widget2"></div>
            </div>
            <div class="widgetDropzone hidden" id="widget3-dropzone">
                <div class="widget" id="widget3"></div>
            </div>
            <div class="widgetDropzone hidden" id="widget4-dropzone">
                <div class="widget" id="widget4"></div>
            </div>
            <div id="mainWorkspace-dropzone">
                <div class="widget" id="mainWorkspace"></div>
            </div>
            <div id="footer"></div>
        </div>
    </template>
    <script>
        Polymer({
            addWidget: function (targetId, content) {
                function contains(source, searchTerm) {
                    for (var i in searchTerm) {
                        if (source[i] !== searchTerm[i]) {
                            return false;
                        }
                    }
                    return true;
                }

                if (contains(targetId, 'widget') || contains(targetId, 'mainWorkspace')) {
                    console.log('is widget or mainWorkspace: ' + targetId);

                    var targetDropzone = this.$[targetId + '-dropzone'];
                    if (targetDropzone == null) {
                        console.error('Parent dropzone for ' + targetId + ' not found');
                        return;
                    }
                    // show the dropzone if a widget is present
                    targetDropzone.classList.remove('hidden');

                    if (targetDropzone.children.length != 1) {
                        console.error('The dropzone ofclass="widget" ' + targetId + ' must only contain a single div for the widget itself.');
                        return;
                    }
                    var target = targetDropzone.children[0];

                    // activate draggable and dropzones
                    require(['core-dnd'], function (dnd) {
                        dnd.makeDraggable(target);
                        dnd.makeDropZone(targetDropzone, '.widget');
                        console.log('dropzone and draggable created');
                    });
                }

                this.setContent(targetId, content);
            },
            ready: function () {
                console.log('workspace-layout touchwall is ready.');
            }
        });
    </script>
</polymer-element>