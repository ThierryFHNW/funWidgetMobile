<link rel="import" href="../elements/app-layout.html">
<link rel="import" href="../elements/awall-menu.html">

<polymer-element name="workspace-layout-touchwall" extends="app-layout">
    <template>
        <style>
            #container {
                display: flex;
                height: 100vh;
                flex-direction: column;
            }

            header, footer {
                color: white;
                padding: 1em;
                background-color: #000000;
                display: none;
            }

            #body {
                flex: 1;
                padding: 0.3em;
                display: flex;
                flex-direction: column;
                overflow-y: scroll;
            }

            #widgets {
                display: flex;
            }

            .widgetDropzone {
                flex: 1 1 10%;
                margin-right: 0.3em;
                margin-bottom: 0.3em;
                height: 13em;
                box-sizing: border-box;
                position: relative;
            }

            @media only screen and (max-height: 40rem) {
                .widgetDropzone {
                    height: 3.5em;
                }
            }

            #widgetmain {
                position: relative;
                height: 100%;
                width: 100%;
            }

            .hidden {
                display: none;
            }
        </style>
        <div id="container">
            <header>HEADER</header>
            <div id="body">
                <div id="widgets">
                    <div class="widgetDropzone hidden" id="widget1"></div>
                    <div class="widgetDropzone hidden" id="widget2"></div>
                    <div class="widgetDropzone hidden" id="widget3"></div>
                    <div class="widgetDropzone hidden" id="widget4"></div>
                    <div class="widgetDropzone hidden" id="widget5"></div>
                    <div class="widgetDropzone hidden" id="widget6"></div>
                    <div class="widgetDropzone hidden" id="widget7"></div>
                    <div class="widgetDropzone hidden" id="widget8"></div>
                    <div class="widgetDropzone hidden" id="widget9"></div>
                    <div class="widgetDropzone hidden" id="widget10"></div>
                    <awall-menu></awall-menu>
                </div>
                <div id="widgetmain"></div>
            </div>

            <footer>FOOTER</footer>
        </div>
    </template>
    <script>
        Polymer(Polymer.mixin({
            widgetIdToView: {},
            addWidget: function (widget, widgetNode) {
                var targetId = 'widget' + widget.position;
                var targetView = this.$[targetId];

                if (targetView === null) {
                    console.error('No element with the ID ' + targetId + ' exists, cannot add widget ' + widget.id);
                    return;
                }

                this.widgetIdToView[widget.id] = targetView;

                // adjust the width of the widget
                if (widget.width > 1) {
                    // widget may be max. 50% of width
                    var widgetWidth = widget.width > 5 ? 5 : widget.width;
                    targetView.style.flexBasis = (10 * widgetWidth) + '%';
                }

                // enable dropzone for all widgets except main widget
                if (widget.position !== 'main') {
                    // show the dropzone if a widget is present
                    targetView.classList.remove('hidden');

                    // activate dropzone
                    this.touch.makeDropzone(targetView, '.widget');
                }

                this.setView(targetId, widgetNode);

                if (widget.hidden) {
                    this.hideWidget(widget);
                }
            },
            hideWidget: function (widget) {
                var widgetView = this.widgetIdToView[widget.id];
                if (widgetView === undefined) {
                    console.error('Cannot hide widget with id: ' + widget.id + ', not registered.');
                    return;
                }
                widgetView.classList.add('hidden');
            },
            showWidget: function (widget) {
                var widgetView = this.widgetIdToView[widget.id];
                if (widgetView === undefined) {
                    console.error('Cannot show widget with id: ' + widget.id + ', not registered.');
                    return;
                }
                widgetView.classList.remove('hidden');
            },
            isWidgetShown: function (widget) {
                var widgetView = this.widgetIdToView[widget.id];
                if (widgetView === undefined) {
                    console.error('Widget with id: ' + widget.id + ' is not registered.');
                    return;
                }
                return !widgetView.classList.contains('hidden');
            }
        }, window.appMixin));
    </script>
</polymer-element>