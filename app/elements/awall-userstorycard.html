<link rel="import" href="awall-form.html">

<polymer-element name="awall-userstorycard">
    <template>
        <style>
            #container {
                float: left;
                overflow: hidden;
                height: 5em;
                width: 15em;
                padding: 0.4em;
                margin: 0.4em;
                background-color: #ffc473;
                border: 2px solid;
                box-shadow: 0.15em 0.15em 0.15em #888, 0.15em 0.15em 0.15em #888;
            }

            ul {
                list-style: none;
                margin: 0;
                padding: 0;
            }

            .circle {
                float: right;
                height: 2em;
            }

            .circle-content {
                width: 2em;
                height: 2em;
                line-height: 2em;
                text-align: center;
                border-radius: 50%;
                border: 1px solid #000000;
            }
        </style>
        <div id="container" class="userstorycard">
            <div class="circle">
                <div class="circle-content">
                    {{userstory.storyPoints | noNull}}
                </div>
            </div>
            <ul>
                <li><b>{{userstory.name}}</b></li>
                <li>
                    <small>Prio: {{userstory.priority}}</small>
                </li>
                <li>
                    <small>{{userstory.description}}</small>
                </li>
            </ul>
        </div>
        <awall-form-userstory id="form" userstory="{{userstory}}"></awall-form-userstory>
    </template>
    <script>
        Polymer({
            publish: {
                userstory: undefined,
                /**
                 * Switch to disable draggability of the element.
                 *
                 * @attribute disableDraggable
                 * @type boolean
                 * @default false
                 */
                disableDraggable: false
            },
            domReady: function () {
                // capture variables
                var container = this.$.container;
                var draggableData = this.userstory;
                var form = this.$.form;

                // make draggable
                if (!this.disableDraggable) {
                    require(['core-touch'], function (touch) {
                        touch.makeDraggable(container, {
                            clone: true,
                            data: draggableData
                        });
                    });
                }

                // doubletap to show form
                require(['core-touch'], function (touch) {
                    touch.onDoubleTap(container, function (event) {
                        form.open();
                    })
                });
            },
            noNull: function(value) {
                return value == null ? '-' : value;
            }
        });
    </script>
</polymer-element>