<link rel="import" href="ads-rest.html">
<link rel="import" href="ads-form.html">

<polymer-element name="ads-taskcard">
    <template>
        <style>
            #container {
                float: left;
                overflow: hidden;
                height: 60px;
                width: 200px;
                min-height: 50px;
                min-width: 175px;
                padding: 5px;
                margin: 5px;
                background-color: #ffffff;
                border: 2px solid;
                box-shadow: 3px 3px 3px #888, 3px 3px 3px #888;
            }

            ul {
                list-style: none;
                margin: 0;
                padding: 0;
            }
        </style>
        <div id="container" class="taskcard">
            <ul>
                <li><b>{{task.name}}</b></li>
                <li>
                    <small><b>{{task.assignee.name}}</b></small>
                </li>
                <li>
                    <small>{{task.description}}</small>
                </li>
            </ul>
        </div>
        <ads-rest-task id="rest"></ads-rest-task>
        <ads-form-task id="form" task="{{task}}" userstory="{{task.userStory}}"></ads-form-task>
    </template>
    <script>
        Polymer({
            publish: {
                task: undefined,

                /**
                 * Disables draggable functionality if true.
                 * Default: false.
                 */
                disableDraggable: false
            },
            domReady: function () {
                // capture variables
                var container = this.$.container;
                var task = this.task;
                var rest = this.$.rest;
                var form = this.$.form;

                // dropzone for avatars
                require(['core-touch'], function (touch) {
                    touch.makeDropZone(container, '.avatar', function(data) {
                        task.assignee = data;
                        rest.save(task);
                    });
                });

                // make draggable
                if (!this.disableDraggable) {
                    require(['core-touch'], function (touch) {
                        touch.makeDraggable(container, {
                            clone: true,
                            data: task
                        });
                    });
                }

                // doubletap to show form
                require(['core-touch'], function (touch) {
                    touch.onDoubleTap(container, function(event) {
                        form.open();
                    })
                });
            }
        });
    </script>
</polymer-element>