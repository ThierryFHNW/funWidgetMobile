<polymer-element name="awall-widget">
    <template>
        <style>
            #widget {
                height: 100%;
                background-color: #f2f2f2;
                border: 2px solid #000000;
                box-sizing: border-box;
                overflow: auto;
                position: relative;
            }

            ::content h2 {
                padding: 5px;
                margin: 5px;
                font-size: 20px;
                font-weight: bold;
            }

            .body {
                padding: 5px;
                overflow: auto;
            }

            .iconbar {
                float: right;
                margin: 2px;
                height: 25px;
            }

        </style>

        <div id="widget" class="widget">
            <div class="iconbar">
                <core-icon-button icon="aspect-ratio" hidden?="{{hideResizeToInitial}}"
                                  on-tap="{{resizeToInitial}}"></core-icon-button>
                <core-icon-button icon="dashboard" hidden?="{{hideRevertToDock}}"
                                  on-tap="{{revertToDock}}"></core-icon-button>
            </div>
            <content select="h2"></content>
            <div class="body">
                <content select="*"></content>
            </div>
        </div>
    </template>
    <script>
        Polymer({
            publish: {
                /**
                 * Switch to disable draggability of the element.
                 *
                 * @attribute disableDraggable
                 * @type boolean
                 * @default false
                 */
                disableDraggable: false,
                /**
                 * Switch to disable resizability of the element.
                 *
                 * @attribute disableResizable
                 * @type boolean
                 * @default false
                 */
                disableResizable: false
            },
            hideResizeToInitial: true,
            hideRevertToDock: true,
            domReady: function () {
                // capture variables
                var elementThis = this;

                require(['core-touch'], function (touch) {
                    var widget = elementThis.$.widget;
                    if (!elementThis.disableDraggable) {
                        touch.makeDraggable(widget, {
                            revert: false,
                            onstart: function () {
                                elementThis.hideRevertToDock = false;
                            },
                            onend: function (event) {
                                elementThis.hideRevertToDock = event.interaction.dropped;
                            }
                        });
                    }
                    if (!elementThis.disableResizable) {
                        touch.makeResizable(widget, {
                            onstart: function () {
                                elementThis.hideResizeToInitial = false;
                            },
                            disableMove: function () {
                                return elementThis.hideRevertToDock;
                            },
                            onend: function () {
                                elementThis.hideResizeToInitial = touch.isInitialSize(widget);
                            }
                        });
                    }
                });
            },
            resizeToInitial: function () {
                var widget = this.$.widget;
                require(['core-touch'], function (touch) {
                    touch.resizeToInitial(widget);
                });
                this.hideResizeToInitial = true;
            },
            revertToDock: function () {
                var widget = this.$.widget;
                require(['core-touch'], function (touch) {
                    touch.resetPosition(widget);
                });
                this.hideRevertToDock = true;
            }
        });
    </script>
</polymer-element>